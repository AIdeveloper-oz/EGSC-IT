source ~/.bashrc_liqianma

#### Download GTA5 and BDD datasets, then uncompress them into '../data/'
## Here, we the gta25k data are reused from that generated by prepare_data_gta_city.sh
## Some we use link directly

## Define data path
src_A_dir='../data/GTA5'
src_B_dir='../data/BDD'
dst_dir='../data/gta25k_bdd'

# rm -rf ${dst_dir}
mkdir ${dst_dir}
ln -s ${src_A_dir}'/trainA' ${dst_dir}'/trainA'
ln -s ${src_A_dir}'/trainA_seg' ${dst_dir}'/trainA_seg'
ln -s ${src_A_dir}'/trainA_seg_class_8catId' ${dst_dir}'/trainA_seg_class_8catId'
ln -s ${src_A_dir}'/trainA_seg_class_20trainId' ${dst_dir}'/trainA_seg_class_20trainId'
ln -s ${src_A_dir}'/testA' ${dst_dir}'/testA'
ln -s ${src_A_dir}'/testA_seg' ${dst_dir}'/testA_seg'
ln -s ${src_A_dir}'/testA_seg_class_8catId' ${dst_dir}'/testA_seg_class_8catId'
ln -s ${src_A_dir}'/testA_seg_class_20trainId' ${dst_dir}'/testA_seg_class_20trainId'
ln -s ${src_B_dir}'/segmentation/train/raw_images' ${dst_dir}'/trainB'
ln -s ${src_B_dir}'/segmentation/train/class_color' ${dst_dir}'/trainB_seg'

ln -s ${src_B_dir}'/videos/out_img' ${dst_dir}'/trainB_extra'

ln -s ${src_B_dir}'/segmentation/val/raw_images' ${dst_dir}'/testB'
ln -s ${src_B_dir}'/segmentation/val/class_color' ${dst_dir}'/testB_seg'

## Generate segment class
python segment_class.py --data_dir=${dst_dir} --dataset='gta25k_bdd' --use_8catId=True
 
## Conver to tf-record
for IsTrain in 0 1
do
    python convert_gta.py ${dst_dir} ${IsTrain}
done